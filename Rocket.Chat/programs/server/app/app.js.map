{"version":3,"sources":["meteor://ðŸ’»app/server/lib/cordova/facebook-login.js","meteor://ðŸ’»app/server/lib/accounts.js","meteor://ðŸ’»app/server/lib/cordova.js","meteor://ðŸ’»app/server/startup/migrations/v001.js","meteor://ðŸ’»app/server/startup/migrations/v002.js","meteor://ðŸ’»app/server/startup/migrations/v003.js","meteor://ðŸ’»app/server/startup/migrations/v004.js","meteor://ðŸ’»app/server/startup/migrations/v005.js","meteor://ðŸ’»app/server/startup/migrations/v006.js","meteor://ðŸ’»app/server/startup/migrations/v007.js","meteor://ðŸ’»app/server/startup/migrations/v008.js","meteor://ðŸ’»app/server/startup/migrations/v009.js","meteor://ðŸ’»app/server/startup/migrations/v010.js","meteor://ðŸ’»app/server/startup/migrations/v011.js","meteor://ðŸ’»app/server/startup/migrations/v012.js","meteor://ðŸ’»app/server/startup/migrations/v013.js","meteor://ðŸ’»app/server/startup/migrations/v014.js","meteor://ðŸ’»app/server/startup/migrations/v015.js","meteor://ðŸ’»app/server/startup/migrations/v016.js","meteor://ðŸ’»app/server/startup/migrations/v017.js","meteor://ðŸ’»app/server/startup/migrations/v018.js","meteor://ðŸ’»app/server/startup/migrations/v019.js","meteor://ðŸ’»app/server/startup/migrations/v020.js","meteor://ðŸ’»app/server/startup/migrations/v021.js","meteor://ðŸ’»app/server/startup/migrations/v022.js","meteor://ðŸ’»app/server/startup/migrations/v023.js","meteor://ðŸ’»app/server/startup/migrations/v024.js","meteor://ðŸ’»app/server/startup/migrations/v025.js","meteor://ðŸ’»app/server/startup/migrations/v026.js","meteor://ðŸ’»app/server/startup/migrations/v027.js","meteor://ðŸ’»app/server/startup/migrations/v028.js","meteor://ðŸ’»app/server/startup/migrations/v029.js","meteor://ðŸ’»app/server/startup/migrations/v030.js","meteor://ðŸ’»app/server/startup/migrations/v031.js","meteor://ðŸ’»app/server/startup/migrations/v032.js","meteor://ðŸ’»app/server/startup/migrations/v033.js","meteor://ðŸ’»app/server/startup/migrations/v034.js","meteor://ðŸ’»app/server/startup/migrations/v035.js","meteor://ðŸ’»app/server/startup/migrations/v036.js","meteor://ðŸ’»app/server/startup/migrations/v037.js","meteor://ðŸ’»app/server/startup/migrations/v038.js","meteor://ðŸ’»app/server/startup/migrations/v039.js","meteor://ðŸ’»app/server/startup/migrations/v040.js","meteor://ðŸ’»app/server/startup/migrations/v041.js","meteor://ðŸ’»app/server/startup/migrations/v042.js","meteor://ðŸ’»app/server/startup/migrations/v043.js","meteor://ðŸ’»app/server/startup/migrations/v044.js","meteor://ðŸ’»app/server/startup/migrations/v045.js","meteor://ðŸ’»app/server/startup/migrations/v046.js","meteor://ðŸ’»app/server/startup/migrations/v047.js","meteor://ðŸ’»app/server/startup/migrations/v048.js","meteor://ðŸ’»app/server/startup/migrations/v049.js","meteor://ðŸ’»app/server/startup/migrations/v050.js","meteor://ðŸ’»app/server/startup/migrations/v051.js","meteor://ðŸ’»app/server/startup/migrations/v052.js","meteor://ðŸ’»app/server/startup/migrations/v053.js","meteor://ðŸ’»app/server/startup/migrations/v054.js","meteor://ðŸ’»app/server/startup/migrations/v055.js","meteor://ðŸ’»app/server/startup/migrations/v056.js","meteor://ðŸ’»app/server/startup/migrations/v057.js","meteor://ðŸ’»app/server/startup/migrations/v058.js","meteor://ðŸ’»app/server/startup/migrations/v059.js","meteor://ðŸ’»app/server/startup/migrations/v060.js","meteor://ðŸ’»app/server/startup/migrations/v061.js","meteor://ðŸ’»app/server/startup/migrations/v062.js","meteor://ðŸ’»app/server/startup/migrations/v063.js","meteor://ðŸ’»app/server/startup/migrations/v064.js","meteor://ðŸ’»app/server/startup/migrations/v065.js","meteor://ðŸ’»app/server/startup/migrations/v066.js","meteor://ðŸ’»app/server/startup/migrations/v067.js","meteor://ðŸ’»app/server/startup/migrations/v068.js","meteor://ðŸ’»app/server/startup/migrations/v069.js","meteor://ðŸ’»app/server/startup/migrations/v070.js","meteor://ðŸ’»app/server/startup/migrations/v071.js","meteor://ðŸ’»app/server/startup/migrations/v072.js","meteor://ðŸ’»app/server/startup/migrations/v073.js","meteor://ðŸ’»app/server/startup/migrations/v074.js","meteor://ðŸ’»app/server/startup/migrations/v075.js","meteor://ðŸ’»app/server/startup/migrations/v076.js","meteor://ðŸ’»app/server/startup/migrations/v077.js","meteor://ðŸ’»app/server/startup/migrations/v078.js","meteor://ðŸ’»app/server/startup/migrations/v079.js","meteor://ðŸ’»app/server/startup/migrations/v080.js","meteor://ðŸ’»app/server/startup/migrations/v081.js","meteor://ðŸ’»app/server/startup/migrations/v082.js","meteor://ðŸ’»app/server/startup/migrations/v083.js","meteor://ðŸ’»app/server/startup/migrations/v084.js","meteor://ðŸ’»app/server/startup/migrations/v085.js","meteor://ðŸ’»app/server/startup/migrations/v086.js","meteor://ðŸ’»app/server/startup/migrations/v087.js","meteor://ðŸ’»app/server/startup/migrations/v088.js","meteor://ðŸ’»app/server/startup/migrations/v089.js","meteor://ðŸ’»app/server/startup/migrations/v090.js","meteor://ðŸ’»app/server/startup/migrations/v091.js","meteor://ðŸ’»app/server/startup/migrations/v092.js","meteor://ðŸ’»app/server/startup/migrations/v093.js","meteor://ðŸ’»app/server/startup/migrations/v094.js","meteor://ðŸ’»app/server/startup/migrations/v095.js","meteor://ðŸ’»app/server/startup/migrations/v096.js","meteor://ðŸ’»app/server/startup/migrations/v097.js","meteor://ðŸ’»app/server/startup/migrations/v098.js","meteor://ðŸ’»app/server/startup/migrations/v099.js","meteor://ðŸ’»app/server/startup/migrations/xrun.js","meteor://ðŸ’»app/server/startup/appcache.js","meteor://ðŸ’»app/server/startup/avatar.js","meteor://ðŸ’»app/server/startup/cron.js","meteor://ðŸ’»app/server/startup/i18n-validation.js","meteor://ðŸ’»app/server/startup/initialData.js","meteor://ðŸ’»app/server/startup/presence.js","meteor://ðŸ’»app/server/startup/roomPublishes.js","meteor://ðŸ’»app/server/startup/serverRunning.js","meteor://ðŸ’»app/server/configuration/accounts_meld.js","meteor://ðŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ðŸ’»app/server/methods/addAllUserToRoom.js","meteor://ðŸ’»app/server/methods/addRoomLeader.js","meteor://ðŸ’»app/server/methods/addRoomModerator.js","meteor://ðŸ’»app/server/methods/addRoomOwner.js","meteor://ðŸ’»app/server/methods/afterVerifyEmail.js","meteor://ðŸ’»app/server/methods/canAccessRoom.js","meteor://ðŸ’»app/server/methods/channelsList.js","meteor://ðŸ’»app/server/methods/createDirectMessage.js","meteor://ðŸ’»app/server/methods/deleteFileMessage.js","meteor://ðŸ’»app/server/methods/deleteUser.js","meteor://ðŸ’»app/server/methods/eraseRoom.js","meteor://ðŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ðŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ðŸ’»app/server/methods/getRoomNameById.js","meteor://ðŸ’»app/server/methods/getTotalChannels.js","meteor://ðŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ðŸ’»app/server/methods/getUsersOfRoom.js","meteor://ðŸ’»app/server/methods/groupsList.js","meteor://ðŸ’»app/server/methods/hideRoom.js","meteor://ðŸ’»app/server/methods/loadHistory.js","meteor://ðŸ’»app/server/methods/loadLocale.js","meteor://ðŸ’»app/server/methods/loadMissedMessages.js","meteor://ðŸ’»app/server/methods/loadNextMessages.js","meteor://ðŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ðŸ’»app/server/methods/logoutCleanUp.js","meteor://ðŸ’»app/server/methods/messageSearch.js","meteor://ðŸ’»app/server/methods/migrate.js","meteor://ðŸ’»app/server/methods/muteUserInRoom.js","meteor://ðŸ’»app/server/methods/openRoom.js","meteor://ðŸ’»app/server/methods/readMessages.js","meteor://ðŸ’»app/server/methods/registerUser.js","meteor://ðŸ’»app/server/methods/removeRoomLeader.js","meteor://ðŸ’»app/server/methods/removeRoomModerator.js","meteor://ðŸ’»app/server/methods/removeRoomOwner.js","meteor://ðŸ’»app/server/methods/removeUserFromRoom.js","meteor://ðŸ’»app/server/methods/reportMessage.js","meteor://ðŸ’»app/server/methods/resetAvatar.js","meteor://ðŸ’»app/server/methods/roomNameExists.js","meteor://ðŸ’»app/server/methods/saveUserPreferences.js","meteor://ðŸ’»app/server/methods/saveUserProfile.js","meteor://ðŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ðŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ðŸ’»app/server/methods/setAvatarFromService.js","meteor://ðŸ’»app/server/methods/setUserActiveStatus.js","meteor://ðŸ’»app/server/methods/setUserPassword.js","meteor://ðŸ’»app/server/methods/toogleFavorite.js","meteor://ðŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ðŸ’»app/server/methods/userSetUtcOffset.js","meteor://ðŸ’»app/server/publications/activeUsers.js","meteor://ðŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ðŸ’»app/server/publications/fullUserData.js","meteor://ðŸ’»app/server/publications/messages.js","meteor://ðŸ’»app/server/publications/privateHistory.js","meteor://ðŸ’»app/server/publications/room.js","meteor://ðŸ’»app/server/publications/roomFiles.js","meteor://ðŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ðŸ’»app/server/publications/spotlight.js","meteor://ðŸ’»app/server/publications/subscription.js","meteor://ðŸ’»app/server/publications/userAutocomplete.js","meteor://ðŸ’»app/server/publications/userChannels.js","meteor://ðŸ’»app/server/publications/userData.js","meteor://ðŸ’»app/server/stream/messages.js","meteor://ðŸ’»app/server/stream/streamBroadcast.js","meteor://ðŸ’»app/lib/RegExp.js","meteor://ðŸ’»app/lib/francocatena_fix.js","meteor://ðŸ’»app/lib/underscore.string.js"],"names":["getIdentity","accessToken","HTTP","get","params","access_token","data","error","_","extend","Error","message","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","Date","now","expiresIn","whitelisted","fields","pick","options","profile","updateOrCreateUserFromExternalService","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","RocketChat","settings","config","emailTemplates","siteName","from","verifyEmailHtml","verifyEmail","text","html","user","url","replace","Meteor","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","subject","TAPi18n","__","lng","language","placeholders","header","footer","name","email","emails","address","onCreateUser","callbacks","run","status","active","firstName","lastName","services","Object","values","service","username","verified","insertUserDoc","wrap","roles","Match","test","globalRoles","String","length","concat","password","defaultAuthServiceRoles","split","map","s","trim","type","_id","call","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","hasAdmin","models","Users","push","authz","addUserRoles","validateLoginAttempt","login","allowed","includes","validEmail","filter","updateLastLoginById","defer","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","methods","push_test","method","hasRole","Push","enabled","query","$and","userId","$or","$exists","tokens","appCollection","find","count","send","title","apn","sound","sendPush","token","tries","post","statusCode","console","log","remove","SystemLogger","milli","Math","pow","setTimeout","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","forEach","app","topic","appName","startup","Migrations","add","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","RocketChatFile","dataURIParse","image","contentType","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","Subscriptions","tryDropIndex","uid","nonreactive","sub","update","findOneById","$set","$unset","Rooms","room","$in","uids","usernames","t","k","v","oldId","sort","join","removeById","rid","multi","Messages","rn","$rename","item","Random","id","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","u","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","value","group","ENV","MAIL_URL","denyUnverifiedEmails","public","avatarStore","path","toMigrate","source","Mongo","Collection","target","model","OEmbedCache","collection","rawCollection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","oldAndNew","oldSetting","oldValue","newSetting","new","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","to","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","Roles","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","module","watch","require","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","e","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","list","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","ts","code","tryEnsureIndex","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","args","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","fn","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","WebApp","connectHandlers","use","bindEnvironment","req","res","decodeURIComponent","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","colors","color","initials","position","usernameParts","first","substr","toUpperCase","svg","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","host","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","adminUser","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","parse","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","announcement","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","hasPermission","joinCode","findByTypeAndName","roomId","findByTypeNameAndUserId","findById","ready","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","toString","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","Array","isArray","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","arguments","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","unread","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","role","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","canAccessRoom","Maybe","channelsList","channelType","unblock","Optional","isNumber","roomIds","findByTypeAndUserId","userPref","mergeChannels","roomsListExhibitionMode","globalPref","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","ls","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","action","eraseRoom","fromId","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","$regex","generateSuggestion","preferredHandle","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","total","groupsList","nameFilter","groups","escapeRegExp","findByIds","hideRoom","hideByRoomIdAndUserId","hideMessagesOfType","types","loadHistory","canAnonymous","canPreview","editedAt","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","UI_Use_Real_Name","messages","starred","mention","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","sortByTimestamp","direction","startsWith","$options","r","$text","$search","score","$meta","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","setAsReadByRoomIdAndUserId","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","_loginUser","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","messageId","Reports","createWithMessageDescriptionAndUserId","resetAvatar","unsetAvatarOrigin","DDPRateLimiter","addRule","roomNameExists","saveUserPreferences","setLanguage","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","unreadRoomsMode","autoImageLoad","emailNotificationMode","unreadAlert","notificationsSoundVolume","desktopNotifications","mobileNotifications","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","highlights","sendOnEnter","setPreferences","saveUserProfile","customFields","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","regex","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","findByContainingUsername","lm","fname","_updatedAt","livechatData","tags","sms","lastActivity","sentiment","roomMap","_room","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","trashFindDeletedAfter","_deletedAt","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","on","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","spotlight","roomOptions","findByNameAndTypeNotDefault","userOptions","findByActiveUsersExcept","findByNameAndTypeNotContainingUsername","audioNotification","mobilePushNotifications","emailNotifications","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","findByUserId","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","roomType","publishMessage","imported","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","broadcast","fromInstance","results","connected","endpoint","conn","assign","currentStatus","i18n_status_func","mixin","each","functions","prototype","exports"],"mappings":"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","file":"/app.js","sourcesContent":["function getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","const accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function(user, url) {\n\turl = url.replace(/\\/#\\//, '/');\n\treturn resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id\n\t});\n\n\tif (user.username && options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\tMeteor.runAsUser(_id, function() {\n\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t});\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://demo.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true }\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'emails.address.address': 1}).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some(email => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }`} }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>`} }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/'\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({err});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => {\n\t\treturn fn(item);\n\t})).then(() => { return batch(arr, limit, fn); });\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'store': 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin'\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStorePath'});\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStoreType'});\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars'\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({avatarOrigin: {$in: avatarOrigins}}, {avatarOrigin: 1, username: 1}).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStoreType'});\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStorePath'});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t}\n});\n","if (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","/* globals FileUpload */\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst colors = ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFC107', '#FF9800', '#FF5722', '#795548', '#9E9E9E', '#607D8B'];\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tconst position = username.length % colors.length;\n\n\t\t\t\t\tcolor = colors[position];\n\t\t\t\t\tusername = username.replace(/[^A-Za-z0-9]/g, '.').replace(/\\.+/g, '.').replace(/(^\\.)|(\\.$)/g, '');\n\n\t\t\t\t\tconst usernameParts = username.split('.');\n\n\t\t\t\t\tinitials = usernameParts.length > 1 ? _.first(usernameParts)[0] + _.last(usernameParts)[0] : username.replace(/[^A-Za-z0-9]/g, '').substr(0, 2);\n\t\t\t\t\tinitials = initials.toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst svg = `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" pointer-events=\\\"none\\\" width=\\\"50\\\" height=\\\"50\\\">\\n<rect height=\"50\" width=\"50\" fill=\\\"${ color }\\\"/>\\n<text text-anchor=\\\"middle\\\" y=\\\"50%\\\" x=\\\"50%\\\" dy=\\\"0.36em\\\" pointer-events=\\\"auto\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-weight=\"400\" font-size=\"28\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\t\treturn SyncedCron.start();\n\t});\n});\n","function flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","Meteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png'\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-join-code')) {\n\t\t\toptions.fields.joinCode = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","const orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcanAccessRoom(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst user = Meteor.user();\n\t\t\tconst userPref = user && user.settings && user.settings.preferences && user.settings.preferences.mergeChannels && user.settings.preferences.roomsListExhibitionMode === 'category';\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref !== undefined ? userPref : globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(fromId, `delete-${ room.t }`, rid)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername({\n\t\t$regex: new RegExp(`^${ username }$`, 'i')\n\t});\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn {\n\t\t\t\t_id: record._user._id,\n\t\t\t\tusername: record._user.username,\n\t\t\t\tname: record._user.name\n\t\t\t};\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tgroupsList(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (_.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","const hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end != null) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tlet unreadNotLoaded = 0;\n\t\tlet firstUnread;\n\n\t\tif (ls != null) {\n\t\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\t\tif ((firstMessage != null ? firstMessage.ts : undefined) > ls) {\n\t\t\t\tdelete options.limit;\n\n\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\t\tlimit: 1,\n\t\t\t\t\tsort: {\n\t\t\t\t\t\tts: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessages,\n\t\t\tfirstUnread,\n\t\t\tunreadNotLoaded\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","Meteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","Meteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tconst result = {\n\t\t\tmessages: [],\n\t\t\tusers: [],\n\t\t\tchannels: []\n\t\t};\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\tcheck(text, String);\n\t\tcheck(rid, String);\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\t\tconst currentUserName = Meteor.user().username;\n\t\tconst currentUserTimezoneOffset = Meteor.user().utcOffset;\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm' //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true // don't return _hidden messages\n\t\t\t};\n\t\t\tif (rid != null) {\n\t\t\t\tquery.rid = rid;\n\t\t\t\tif (Meteor.call('canAccessRoom', rid, currentUserId) !== false) {\n\t\t\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\t\t\toptions.fields = {\n\t\t\t\t\t\t\t'editedAt': 0\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\tresult.messages = RocketChat.models.Messages.find(query, options).fetch();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists'\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t}\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tcheck(settings, Object);\n\n\t\tif (Meteor.userId()) {\n\t\t\tconst preferences = {};\n\n\t\t\tif (settings.language != null) {\n\t\t\t\tRocketChat.models.Users.setLanguage(Meteor.userId(), settings.language);\n\t\t\t}\n\n\t\t\tif (settings.newRoomNotification) {\n\t\t\t\tpreferences.newRoomNotification = settings.newRoomNotification;\n\t\t\t}\n\n\t\t\tif (settings.newMessageNotification) {\n\t\t\t\tpreferences.newMessageNotification = settings.newMessageNotification;\n\t\t\t}\n\n\t\t\tif (settings.useEmojis) {\n\t\t\t\tpreferences.useEmojis = settings.useEmojis === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.convertAsciiEmoji) {\n\t\t\t\tpreferences.convertAsciiEmoji = settings.convertAsciiEmoji === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.saveMobileBandwidth) {\n\t\t\t\tpreferences.saveMobileBandwidth = settings.saveMobileBandwidth === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.collapseMediaByDefault) {\n\t\t\t\tpreferences.collapseMediaByDefault = settings.collapseMediaByDefault === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.autoImageLoad) {\n\t\t\t\tpreferences.autoImageLoad = settings.autoImageLoad === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode) {\n\t\t\t\tpreferences.emailNotificationMode = settings.emailNotificationMode;\n\t\t\t}\n\n\t\t\tif (settings.mergeChannels !== '-1') {\n\t\t\t\tpreferences.mergeChannels = settings.mergeChannels === '1';\n\t\t\t} else {\n\t\t\t\tdelete preferences.mergeChannels;\n\t\t\t}\n\t\t\tif (settings.unreadRoomsMode) {\n\t\t\t\tpreferences.unreadRoomsMode = settings.unreadRoomsMode === '1' ? true : false;\n\t\t\t}\n\n\t\t\tpreferences.roomsListExhibitionMode = ['category', 'unread', 'activity'].includes(settings.roomsListExhibitionMode) ? settings.roomsListExhibitionMode : 'category';\n\t\t\tif (settings.unreadAlert) {\n\t\t\t\tpreferences.unreadAlert = settings.unreadAlert === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.notificationsSoundVolume) {\n\t\t\t\tpreferences.notificationsSoundVolume = settings.notificationsSoundVolume;\n\t\t\t}\n\n\t\t\tif (settings.desktopNotifications) {\n\t\t\t\tpreferences.desktopNotifications = settings.desktopNotifications;\n\t\t\t}\n\t\t\tif (settings.mobileNotifications) {\n\t\t\t\tpreferences.mobileNotifications = settings.mobileNotifications;\n\t\t\t}\n\n\t\t\tpreferences.desktopNotificationDuration = settings.desktopNotificationDuration - 0;\n\t\t\tpreferences.viewMode = settings.viewMode || 0;\n\t\t\tpreferences.hideUsernames = settings.hideUsernames === '1';\n\t\t\tpreferences.hideRoles = settings.hideRoles === '1';\n\t\t\tpreferences.hideAvatars = settings.hideAvatars === '1';\n\t\t\tpreferences.hideFlexTab = settings.hideFlexTab === '1';\n\t\t\tpreferences.highlights = settings.highlights;\n\t\t\tpreferences.sendOnEnter = settings.sendOnEnter;\n\n\t\t\tRocketChat.models.Users.setPreferences(Meteor.userId(), preferences);\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tRocketChat.setRealName(Meteor.userId(), settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","Meteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n","Meteor.publish('privateHistory', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Rooms.findByContainingUsername(RocketChat.models.Users.findOneById(this.userId).username, {\n\t\tfields: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t\tmsgs: 1,\n\t\t\tts: 1,\n\t\t\tlm: 1,\n\t\t\tcl: 1\n\t\t}\n\t});\n});\n","const options = {\n\tfields: {\n\t\t_id: 1,\n\t\tname: 1,\n\t\tfname: 1,\n\t\tt: 1,\n\t\tcl: 1,\n\t\tu: 1,\n\t\t// usernames: 1,\n\t\ttopic: 1,\n\t\tannouncement: 1,\n\t\tmuted: 1,\n\t\t_updatedAt: 1,\n\t\tarchived: 1,\n\t\tjitsiTimeout: 1,\n\t\tdescription: 1,\n\t\tdefault: 1,\n\t\tcustomFields: 1,\n\n\t\t// @TODO create an API to register this fields based on room type\n\t\tlivechatData: 1,\n\t\ttags: 1,\n\t\tsms: 1,\n\t\tcode: 1,\n\t\topen: 1,\n\t\tlastActivity: 1,\n\t\tv: 1,\n\t\tlabel: 1,\n\t\tro: 1,\n\t\tsentiment: 1\n\t}\n};\n\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(options.fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\treturn roomMap({_room: room});\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('room_files', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('room_files', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}) {\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\n\t\tif (this.userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch();\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\n\t\tif (type.users === true && RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\tconst userOptions = {\n\t\t\t\tlimit: 5,\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1,\n\t\t\t\t\tname: 1,\n\t\t\t\t\tstatus: 1\n\t\t\t\t},\n\t\t\t\tsort: {}\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\t\tuserOptions.sort.name = 1;\n\t\t\t} else {\n\t\t\t\tuserOptions.sort.username = 1;\n\t\t\t}\n\n\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t}\n\n\t\tif (type.rooms === true && RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\tconst username = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\t\tusername: 1\n\t\t\t}).username;\n\n\t\t\tresult.rooms = RocketChat.models.Rooms.findByNameAndTypeNotContainingUsername(regex, 'c', username, roomOptions).fetch();\n\t\t}\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\tlastActivity: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotification: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = {\n\t\t\tfields\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n\n// TODO needs improvement\n// We are sending the record again cuz any update on subscription will send the record without the fname (join)\n// Then we need to sent it again listening to the join event.\nRocketChat.models.Subscriptions.on('join:fname:inserted', function(subscription/*, user*/) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', 'changed', RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n","Meteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n","/* globals mixin */\n\n// This will add underscore.string methods to Underscore.js\n// except for include, contains, reverse and join that are\n// dropped because they collide with the functions already\n// defined by Underscore.js.\n\nmixin = function(obj) {\n\t_.each(_.functions(obj), function(name) {\n\t\tif (!_[name] && !_.prototype[name]) {\n\t\t\t_[name] = obj[name];\n\t\t}\n\t});\n};\n\nmixin(s.exports());\n"]}