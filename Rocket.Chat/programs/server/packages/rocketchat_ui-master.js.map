{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:ui-master/server/inject.js","meteor://ðŸ’»app/packages/rocketchat:ui-master/server/dynamic-css.js"],"names":["renderDynamicCssList","variables","RocketChat","models","Settings","findOne","_id","fields","value","Inject","rawBody","find","observe","changed","rawHead","require","default","toString","replace","Assets","getText","process","env","DISABLE_ANIMATION","TEST_MODE","settings","get","key","standardFavicons","rawModHtml","html","script","Meteor","defer","baseUrl","__meteor_runtime_config__","ROOT_URL_PATH_PREFIX","trim","test","module","exportDefault","debounce","func","wait","immediate","timeout","args","later","apply","callNow","clearTimeout","setTimeout","cssVarPoly","window","CSS","supports","init","console","time","ratifiedVars","varsByBlock","oldCSS","findCSS","updateCSS","timeEnd","styleBlocks","Array","prototype","concat","document","querySelectorAll","counter","map","block","nodeName","theCSS","innerHTML","findSetters","url","getAttribute","getLink","request","responseText","match","ratifySetters","filter","e","forEach","css","id","newCSS","replaceGetters","el","querySelector","style","createElement","type","classList","add","getElementsByTagName","appendChild","varList","all","variable","curVars","theVar","matches","split","Object","keys","indexOf","success","XMLHttpRequest","open","overrideMimeType","onload","status","warn","onerror","send","stateCheck","setInterval","readyState","clearInterval","DynamicCss","run"],"mappings":"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","file":"/packages/rocketchat_ui-master.js","sourcesContent":["/* globals Inject */\nconst renderDynamicCssList = () => {\n\tconst variables = RocketChat.models.Settings.findOne({_id:'theme-custom-variables'}, {fields: { value: 1}});\n\tif (!variables || !variables.value) {\n\t\treturn;\n\t}\n\tInject.rawBody('dynamic-variables', `<style id='css-variables'>${ variables.value }</style>`);\n};\n\nrenderDynamicCssList();\n\nRocketChat.models.Settings.find({_id:'theme-custom-variables'}, {fields: { value: 1}}).observe({\n\tchanged: renderDynamicCssList\n});\n\nInject.rawHead('dynamic', `<script>(${ require('./dynamic-css.js').default.toString().replace(/\\/\\/.*?\\n/g, '') })()</script>`);\n\nInject.rawHead('page-loading', `<style>${ Assets.getText('public/loading.css') }</style>`);\n\nInject.rawBody('icons', Assets.getText('public/icons.svg'));\n\nInject.rawBody('page-loading-div', `\n<div id=\"initial-page-loading\" class=\"page-loading\">\n\t<div class=\"loading-animation\">\n\t\t<div class=\"bounce1\"></div>\n\t\t<div class=\"bounce2\"></div>\n\t\t<div class=\"bounce3\"></div>\n\t</div>\n</div>`);\n\nif (process.env.DISABLE_ANIMATION || process.env.TEST_MODE === 'true') {\n\tInject.rawHead('disable-animation', `\n\t<style>\n\t\tbody, body * {\n\t\t\tanimation: none !important;\n\t\t\ttransition: none !important;\n\t\t}\n\t</style>\n\t<script>\n\t\twindow.DISABLE_ANIMATION = true;\n\t</script>\n\t`);\n}\n\nRocketChat.settings.get('Assets_SvgFavicon_Enable', (key, value) => {\n\tconst standardFavicons = `\n\t\t<link rel=\"icon\" sizes=\"16x16\" type=\"image/png\" href=\"assets/favicon_16.png\" />\n\t\t<link rel=\"icon\" sizes=\"32x32\" type=\"image/png\" href=\"assets/favicon_32.png\" />`;\n\n\tif (value) {\n\t\tInject.rawHead(key,\n\t\t\t`${ standardFavicons }\n\t\t\t<link rel=\"icon\" sizes=\"any\" type=\"image/svg+xml\" href=\"assets/favicon.svg\" />`);\n\t} else {\n\t\tInject.rawHead(key, standardFavicons);\n\t}\n});\n\nRocketChat.settings.get('theme-color-sidebar-background', (key, value) => {\n\tInject.rawHead(key, `<style>body { background-color: ${ value };}</style>` +\n\t\t\t\t\t\t`<meta name=\"msapplication-TileColor\" content=\"${ value }\" />` +\n\t\t\t\t\t\t`<meta name=\"theme-color\" content=\"${ value }\" />`);\n});\n\nRocketChat.settings.get('Accounts_ForgetUserSessionOnWindowClose', (key, value) => {\n\tif (value) {\n\t\tInject.rawModHtml(key, (html) => {\n\t\t\tconst script = `\n\t\t\t\t<script>\n\t\t\t\t\tif (Meteor._localStorage._data === undefined && window.sessionStorage) {\n\t\t\t\t\t\tMeteor._localStorage = window.sessionStorage;\n\t\t\t\t\t}\n\t\t\t\t</script>\n\t\t\t`;\n\t\t\treturn html.replace(/<\\/body>/, `${ script }\\n</body>`);\n\t\t});\n\t} else {\n\t\tInject.rawModHtml(key, (html) => {\n\t\t\treturn html;\n\t\t});\n\t}\n});\n\nRocketChat.settings.get('Site_Name', (key, value = 'Rocket.Chat') => {\n\tInject.rawHead(key,\n\t\t`<title>${ value }</title>` +\n\t\t`<meta name=\"application-name\" content=\"${ value }\">` +\n\t\t`<meta name=\"apple-mobile-web-app-title\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_language', (key, value = '') => {\n\tInject.rawHead(key,\n\t\t`<meta http-equiv=\"content-language\" content=\"${ value }\">` +\n\t\t`<meta name=\"language\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_robots', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"robots\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_msvalidate01', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"msvalidate.01\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_google-site-verification', (key, value = '') => {\n\tInject.rawHead(key, `<meta name=\"google-site-verification\" content=\"${ value }\" />`);\n});\n\nRocketChat.settings.get('Meta_fb_app_id', (key, value = '') => {\n\tInject.rawHead(key, `<meta property=\"fb:app_id\" content=\"${ value }\">`);\n});\n\nRocketChat.settings.get('Meta_custom', (key, value = '') => {\n\tInject.rawHead(key, value);\n});\n\nMeteor.defer(() => {\n\tlet baseUrl;\n\tif (__meteor_runtime_config__.ROOT_URL_PATH_PREFIX && __meteor_runtime_config__.ROOT_URL_PATH_PREFIX.trim() !== '') {\n\t\tbaseUrl = __meteor_runtime_config__.ROOT_URL_PATH_PREFIX;\n\t} else {\n\t\tbaseUrl = '/';\n\t}\n\tif (/\\/$/.test(baseUrl) === false) {\n\t\tbaseUrl += '/';\n\t}\n\tInject.rawHead('base', `<base href=\"${ baseUrl }\">`);\n});\n","/* global DynamicCss */\n\n'use strict';\nexport default () => {\n\n\tconst debounce = (func, wait, immediate) => {\n\t\tlet timeout;\n\t\treturn function(...args) {\n\t\t\tconst later = () => {\n\t\t\t\ttimeout = null;\n\t\t\t\t!immediate && func.apply(this, args);\n\t\t\t};\n\t\t\tconst callNow = immediate && !timeout;\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t\tcallNow && func.apply(this, args);\n\t\t};\n\t};\n\tconst cssVarPoly = {\n\t\ttest() { return window.CSS && window.CSS.supports && window.CSS.supports('(--foo: red)'); },\n\t\tinit() {\n\t\t\tif (this.test()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconsole.time('cssVarPoly');\n\t\t\tcssVarPoly.ratifiedVars = {};\n\t\t\tcssVarPoly.varsByBlock = [];\n\t\t\tcssVarPoly.oldCSS = [];\n\n\t\t\tcssVarPoly.findCSS();\n\t\t\tcssVarPoly.updateCSS();\n\t\t\tconsole.timeEnd('cssVarPoly');\n\t\t},\n\t\tfindCSS() {\n\t\t\tconst styleBlocks = Array.prototype.concat.apply([], document.querySelectorAll('#css-variables, link[type=\"text/css\"].__meteor-css__'));\n\n\t\t\t// we need to track the order of the style/link elements when we save off the CSS, set a counter\n\t\t\tlet counter = 1;\n\n\t\t\t// loop through all CSS blocks looking for CSS variables being set\n\t\t\tstyleBlocks.map(block => {\n\t\t\t\t// console.log(block.nodeName);\n\t\t\t\tif (block.nodeName === 'STYLE') {\n\t\t\t\t\tconst theCSS = block.innerHTML;\n\t\t\t\t\tcssVarPoly.findSetters(theCSS, counter);\n\t\t\t\t\tcssVarPoly.oldCSS[counter++] = theCSS;\n\t\t\t\t} else if (block.nodeName === 'LINK') {\n\t\t\t\t\tconst url = block.getAttribute('href');\n\t\t\t\t\tcssVarPoly.oldCSS[counter] = '';\n\t\t\t\t\tcssVarPoly.getLink(url, counter, function(counter, request) {\n\t\t\t\t\t\tcssVarPoly.findSetters(request.responseText, counter);\n\t\t\t\t\t\tcssVarPoly.oldCSS[counter++] = request.responseText;\n\t\t\t\t\t\tcssVarPoly.updateCSS();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// find all the \"--variable: value\" matches in a provided block of CSS and add them to the master list\n\t\tfindSetters(theCSS, counter) {\n\t\t\t// console.log(theCSS);\n\t\t\tcssVarPoly.varsByBlock[counter] = theCSS.match(/(--[^:; ]+:..*?;)/g);\n\t\t},\n\n\t\t// run through all the CSS blocks to update the variables and then inject on the page\n\t\tupdateCSS: debounce(() => {\n\t\t\t// first lets loop through all the variables to make sure later vars trump earlier vars\n\t\t\tcssVarPoly.ratifySetters(cssVarPoly.varsByBlock);\n\n\t\t\t// loop through the css blocks (styles and links)\n\t\t\tcssVarPoly.oldCSS.filter(e => e).forEach((css, id) => {\n\t\t\t\tconst newCSS = cssVarPoly.replaceGetters(css, cssVarPoly.ratifiedVars);\n\t\t\t\tconst el = document.querySelector(`#inserted${ id }`);\n\t\t\t\tif (el) {\n\t\t\t\t\t// console.log(\"updating\")\n\t\t\t\t\tel.innerHTML = newCSS;\n\t\t\t\t} else {\n\t\t\t\t\t// console.log(\"adding\");\n\t\t\t\t\tconst style = document.createElement('style');\n\t\t\t\t\tstyle.type = 'text/css';\n\t\t\t\t\tstyle.innerHTML = newCSS;\n\t\t\t\t\tstyle.classList.add('inserted');\n\t\t\t\t\tstyle.id = `inserted${ id }`;\n\t\t\t\t\tdocument.getElementsByTagName('head')[0].appendChild(style);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 100),\n\n\t\t// parse a provided block of CSS looking for a provided list of variables and replace the --var-name with the correct value\n\t\treplaceGetters(oldCSS, varList) {\n\t\t\treturn oldCSS.replace(/var\\((--.*?)\\)/gm, (all, variable) => varList[variable]);\n\t\t},\n\n\t\t// determine the css variable name value pair and track the latest\n\t\tratifySetters(varList) {\n\t\t\t// loop through each block in order, to maintain order specificity\n\t\t\tvarList.filter(curVars => curVars).forEach(curVars => {\n\t\t\t\t// const curVars = varList[curBlock] || [];\n\t\t\t\tcurVars.forEach(function(theVar) {\n\t\t\t\t\t// console.log(theVar);\n\t\t\t\t\t// split on the name value pair separator\n\t\t\t\t\tconst matches = theVar.split(/:\\s*/);\n\t\t\t\t\t// console.log(matches);\n\t\t\t\t\t// put it in an object based on the varName. Each time we do this it will override a previous use and so will always have the last set be the winner\n\t\t\t\t\t// 0 = the name, 1 = the value, strip off the ; if it is there\n\t\t\t\t\tcssVarPoly.ratifiedVars[matches[0]] = matches[1].replace(/;/, '');\n\t\t\t\t});\n\t\t\t});\n\t\t\tObject.keys(cssVarPoly.ratifiedVars).filter(key => {\n\t\t\t\treturn cssVarPoly.ratifiedVars[key].indexOf('var') > -1;\n\t\t\t}).forEach(key => {\n\t\t\t\tcssVarPoly.ratifiedVars[key] = cssVarPoly.ratifiedVars[key].replace(/var\\((--.*?)\\)/gm, function(all, variable) {\n\t\t\t\t\treturn cssVarPoly.ratifiedVars[variable];\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\t// get the CSS file (same domain for now)\n\t\tgetLink(url, counter, success) {\n\t\t\tconst request = new XMLHttpRequest();\n\t\t\trequest.open('GET', url, true);\n\t\t\trequest.overrideMimeType('text/css;');\n\t\t\trequest.onload = function() {\n\t\t\t\tif (request.status >= 200 && request.status < 400) {\n\t\t\t\t\t// Success!\n\t\t\t\t\t// console.log(request.responseText);\n\t\t\t\t\tif (typeof success === 'function') {\n\t\t\t\t\t\tsuccess(counter, request);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// We reached our target server, but it returned an error\n\t\t\t\t\tconsole.warn('an error was returned from:', url);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\trequest.onerror = function() {\n\t\t\t\t// There was a connection error of some sort\n\t\t\t\tconsole.warn('we could not get anything from:', url);\n\t\t\t};\n\n\t\t\trequest.send();\n\t\t}\n\n\t};\n\tconst stateCheck = setInterval(() => {\n\t\tif (document.readyState === 'complete' && typeof Meteor !== 'undefined') {\n\t\t\tclearInterval(stateCheck);\n\t\t\t// document ready\n\t\t\tcssVarPoly.init();\n\t\t}\n\t}, 100);\n\n\tDynamicCss = typeof DynamicCss !=='undefined'? DynamicCss : {};\n\tDynamicCss.test = () => window.CSS && window.CSS.supports && window.CSS.supports('(--foo: red)');\n\tDynamicCss.run = debounce((replace = false) => {\n\t\tif (replace) {\n\t\t\tdocument.querySelector('#css-variables').innerHTML = RocketChat.settings.get('theme-custom-variables');\n\t\t}\n\t\tcssVarPoly.init();\n\t}, 1000);\n};\n"]}