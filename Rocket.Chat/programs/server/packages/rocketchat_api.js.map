{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/requestParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js"],"names":["API","properties","logger","Logger","version","authMethods","helperMethods","Map","defaultFieldsToExclude","joinCode","$loki","meta","_config","defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","addAuthMethod","push","success","result","_","isObject","statusCode","body","failure","errorType","error","unauthorized","msg","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","debug","toUpperCase","url","apply","e","stack","v1","message","name","helperMethod","Restivus","getUserAuth","_getUserAuth","invalidResults","undefined","token","user","bodyParams","payload","JSON","parse","i","length","arguments","includes","Accounts","_hashLoginToken","userId","useDefaultAuth","prettyJson","enableCors","auth","default","addGroup","section","add","type","enableQuery","_id","value","set","_requestParams","queryParams","_getPaginationItems","hardUpperLimit","defaultCount","offset","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","params","requestParams","trim","models","Users","findOneById","username","findOneByUsername","Meteor","Error","_isUserFromParams","_parseJsonQuery","sort","warn","fields","query","_getLoggedInUser","findOne","findChannelByIdOrName","checkedArchived","roomId","roomName","room","Rooms","findOneByName","t","archived","authRequired","post","findResult","runAsUser","call","activeUsersOnly","channel","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","authz","hasPermission","members","customFields","readOnly","id","rid","includeAllPublicChannels","ourQuery","$in","getPaginationItems","parseJsonQuery","assign","integrations","Integrations","find","_createdAt","skip","limit","fetch","total","latestDate","oldestDate","unreads","messages","usernames","rooms","channels","pluck","findByTypeAndUserId","totalCount","processQueryOptionsOnResult","online","findUsersNotOffline","onlineInRoom","indexOf","description","purpose","ro","topic","check","Match","ObjectIncluding","msgId","String","asUser","Maybe","Boolean","Messages","u","ts","now","messageReturn","processWebhookMessage","text","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","group","_room","includeAllPrivateGroups","channelsToSearch","groups","findDirectMessageRoomById","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","emoji","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","_updatedAt","items","target_url","integrationId","getLoggedInUser","hasRole","info","Info","pick","onlineCache","onlineCacheDate","cacheInvalid","icon","types","split","map","hideIcon","TAPi18n","__","iconSize","leftSize","rightSize","width","height","replace","hidden","$ne","public","Settings","findOneNotHiddenById","urlParams","Any","updateValueNotHiddenById","refresh","stats","statistics","Statistics","email","password","active","roles","Array","joinDefaultChannels","requirePasswordChange","sendWelcomeEmail","verified","validateCustomFields","newUserId","saveUser","saveCustomFieldsWithoutValidation","getURL","cdn","full","setHeader","isUserFromParams","presence","status","connectionStatus","statusConnection","lastLogin","filter","fieldsToKeepFromRegularUsers","avatarOrigin","emails","phone","createdAt","services","requirePasswordChangeReason","statusDefault","ourFields","users","avatarUrl","setUserAvatar","Busboy","Npm","require","busboy","wrapAsync","callback","on","bindEnvironment","fieldname","file","filename","encoding","mimetype","imageData","data","Buffer","concat","pipe","userData","extend","saveCustomFields","promclient","register","metrics"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus */\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${ properties.version ? properties.version : 'default' } Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.helperMethods = new Map();\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result={}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.helperMethods) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = { action: endpoints[method] };\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each much\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function() {\n\t\t\t\t\t\tthis.logger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${ method } ${ route } threw an error:`, e.stack);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result ? result : RocketChat.API.v1.success();\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.helperMethods) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n}\n\nRocketChat.API = {};\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nRocketChat.API.v1 = new API({\n\tversion: 'v1',\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n\nRocketChat.API.default = new API({\n\tuseDefaultAuth: true,\n\tprettyJson: true,\n\tenableCors: false,\n\tauth: getUserAuth()\n});\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","RocketChat.API.v1.helperMethods.set('requestParams', function _requestParams() {\n\treturn ['POST', 'PUT'].includes(this.request.method) ? this.bodyParams : this.queryParams;\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.v1.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.v1.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\tconst params = this.requestParams();\n\n\tif (params.userId && params.userId.trim()) {\n\t\tuser = RocketChat.models.Users.findOneById(params.userId) || doesntExist;\n\t} else if (params.username && params.username.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.username) || doesntExist;\n\t} else if (params.user && params.user.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.user) || doesntExist;\n\t} else {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t}\n\n\tif (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.v1.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\tconst params = this.requestParams();\n\n\treturn (!params.userId && !params.username && !params.user) ||\n\t\t(params.userId && this.userId === params.userId) ||\n\t\t(params.username && this.user.username === params.username) ||\n\t\t(params.user && this.user.username === params.user);\n});\n","RocketChat.API.v1.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.v1.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ params, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields: RocketChat.API.v1.defaultFieldsToExclude });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-c')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createChannel', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\t//The find method returns either with the group or the failur\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult._id, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is defined as such only to provide an example of how the routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\t//Special check for the permissions\n\t\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\t\tourQuery.usernames = {\n\t\t\t\t\t$in: [ this.user.username ]\n\t\t\t\t};\n\t\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: { roomId: this.bodyParams.roomId} });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.getMessage', { authRequired: true }, {\n\tget() {\n\t\tif (!this.queryParams.msgId) {\n\t\t\treturn RocketChat.API.v1.failure('The \"msgId\" query parameter must be provided.');\n\t\t}\n\n\n\t\tlet msg;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tmsg = Meteor.call('getSingleMessage', this.queryParams.msgId);\n\t\t});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n","//Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ params, userId, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (params.roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(params.roomId, userId);\n\t} else if (params.roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(params.roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst user = this.getUserFromParams();\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: { roomId: this.bodyParams.roomId}, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","function findDirectMessageRoomById(roomId, userId) {\n\tif (!roomId || !roomId.trim()) {\n\t\treturn RocketChat.API.v1.failure('Body param \"roomId\" is required');\n\t}\n\n\tconst roomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(roomId, userId);\n\n\tif (!roomSub || roomSub.t !== 'd') {\n\t\treturn RocketChat.API.v1.failure(`No direct message room found by the id of: ${ roomId }`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the dm or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoomById(this.queryParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result && result.messages ? result.messages : []\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('d', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoomById(this.bodyParams.roomId, this.userId);\n\n\t\t//The find method returns either with the group or the failure\n\t\tif (findResult.statusCode) {\n\t\t\treturn findResult;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tlet integration;\n\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","RocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\treturn RocketChat.API.v1.success(_.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]));\n\t}\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\t\tlet text;\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"#4c1\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGZpbGw9IiNDMTI3MkQiIGQ9Ik01MDIuNTg2LDI1NS4zMjJjMC0yNS4yMzYtNy41NS00OS40MzYtMjIuNDQ1LTcxLjkzMmMtMTMuMzczLTIwLjE5NS0zMi4xMDktMzguMDcyLTU1LjY4Ny01My4xMzJDMzc4LjkzNywxMDEuMTgyLDMxOS4xMDgsODUuMTY4LDI1Niw4NS4xNjhjLTIxLjA3OSwwLTQxLjg1NSwxLjc4MS02Mi4wMDksNS4zMWMtMTIuNTA0LTExLjcwMi0yNy4xMzktMjIuMjMyLTQyLjYyNy0zMC41NkM2OC42MTgsMTkuODE4LDAsNTguOTc1LDAsNTguOTc1czYzLjc5OCw1Mi40MDksNTMuNDI0LDk4LjM1Yy0yOC41NDIsMjguMzEzLTQ0LjAxLDYyLjQ1My00NC4wMSw5Ny45OThjMCwwLjExMywwLjAwNiwwLjIyNiwwLjAwNiwwLjM0YzAsMC4xMTMtMC4wMDYsMC4yMjYtMC4wMDYsMC4zMzljMCwzNS41NDUsMTUuNDY5LDY5LjY4NSw0NC4wMSw5Ny45OTlDNjMuNzk4LDM5OS45NCwwLDQ1Mi4zNSwwLDQ1Mi4zNXM2OC42MTgsMzkuMTU2LDE1MS4zNjMtMC45NDNjMTUuNDg4LTguMzI3LDMwLjEyNC0xOC44NTcsNDIuNjI3LTMwLjU2YzIwLjE1NCwzLjUyOCw0MC45MzEsNS4zMSw2Mi4wMDksNS4zMWM2My4xMDgsMCwxMjIuOTM3LTE2LjAxNCwxNjguNDU0LTQ1LjA5MWMyMy41NzctMTUuMDYsNDIuMzEzLTMyLjkzNyw1NS42ODctNTMuMTMyYzE0Ljg5Ni0yMi40OTYsMjIuNDQ1LTQ2LjY5NSwyMi40NDUtNzEuOTMyYzAtMC4xMTMtMC4wMDYtMC4yMjYtMC4wMDYtMC4zMzlDNTAyLjU4LDI1NS41NDgsNTAyLjU4NiwyNTUuNDM2LDUwMi41ODYsMjU1LjMyMnoiLz48cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjU2LDEyMC44NDdjMTE2Ljg1NCwwLDIxMS41ODYsNjAuNTA5LDIxMS41ODYsMTM1LjE1NGMwLDc0LjY0MS05NC43MzEsMTM1LjE1NS0yMTEuNTg2LDEzNS4xNTVjLTI2LjAxOSwwLTUwLjkzNy0zLjAwOS03My45NTktOC40OTVjLTIzLjM5NiwyOC4xNDctNzQuODY4LDY3LjI4LTEyNC44NjksNTQuNjI5YzE2LjI2NS0xNy40Nyw0MC4zNjEtNDYuOTg4LDM1LjIwMS05NS42MDNjLTI5Ljk2OC0yMy4zMjItNDcuOTU5LTUzLjE2My00Ny45NTktODUuNjg2QzQ0LjQxNCwxODEuMzU2LDEzOS4xNDUsMTIwLjg0NywyNTYsMTIwLjg0NyIvPjxnPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjI1NiIgY3k9IjI2MC4zNTIiIHI9IjI4LjEwNSIvPjwvZz48Zz48Y2lyY2xlIGZpbGw9IiNDMTI3MkQiIGN4PSIzNTMuNzI4IiBjeT0iMjYwLjM1MiIgcj0iMjguMTA0Ii8+PC9nPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjE1OC4yNzIiIGN5PSIyNjAuMzUyIiByPSIyOC4xMDUiLz48L2c+PC9nPjxnPjxwYXRoIGZpbGw9IiNDQ0NDQ0MiIGQ9Ik0yNTYsMzczLjM3M2MtMjYuMDE5LDAtNTAuOTM3LTIuNjA3LTczLjk1OS03LjM2MmMtMjAuNjU5LDIxLjU0LTYzLjIwOSw1MC40OTYtMTA3LjMwNyw0OS40M2MtNS44MDYsOC44MDUtMTIuMTIxLDE2LjAwNi0xNy41NjIsMjEuODVjNTAsMTIuNjUxLDEwMS40NzMtMjYuNDgxLDEyNC44NjktNTQuNjI5YzIzLjAyMyw1LjQ4Niw0Ny45NDEsOC40OTUsNzMuOTU5LDguNDk1YzExNS45MTcsMCwyMTAuMDQ4LTU5LjU1LDIxMS41NTEtMTMzLjM2NEM0NjYuMDQ4LDMyMS43NjUsMzcxLjkxNywzNzMuMzczLDI1NiwzNzMuMzczeiIvPjwvZz48L3N2Zz4=\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><')\n\t\t};\n\t}\n});\n","// settings endpoints\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\n\t\tconst statistics = RocketChat.models.Statistics.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(ourQuery).count()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.validateCustomFields(this.bodyParams.customFields);\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFieldsWithoutValidation(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ user._id }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet fieldsToKeepFromRegularUsers;\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info')) {\n\t\t\tfieldsToKeepFromRegularUsers = {\n\t\t\t\tavatarOrigin: 0,\n\t\t\t\temails: 0,\n\t\t\t\tphone: 0,\n\t\t\t\tstatusConnection: 0,\n\t\t\t\tcreatedAt: 0,\n\t\t\t\tlastLogin: 0,\n\t\t\t\tservices: 0,\n\t\t\t\trequirePasswordChange: 0,\n\t\t\t\trequirePasswordChangeReason: 0,\n\t\t\t\troles: 0,\n\t\t\t\tstatusDefault: 0,\n\t\t\t\t_updatedAt: 0,\n\t\t\t\tcustomFields: 0\n\t\t\t};\n\t\t}\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst ourFields = Object.assign({}, fields, fieldsToKeepFromRegularUsers, RocketChat.API.v1.defaultFieldsToExclude);\n\n\t\tconst users = RocketChat.models.Users.find(ourQuery, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: ourFields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tavatarUrl: Match.Maybe(String),\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tusername: Match.Maybe(String)\n\t\t}));\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tif (this.bodyParams.avatarUrl) {\n\t\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t\t} else {\n\t\t\t\tconst Busboy = Npm.require('busboy');\n\t\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst imageData = [];\n\t\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}));\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({data}) : RocketChat.API.v1.unauthorized();\n\t}\n});\n","RocketChat.API.default.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n"]}